# 分组查询和过滤
## 1.分组

> GROUP BY 子句将表中数据分成若干小组

### 语法格式

        select column, group_function(column)
        from table
        [where condition]
        [group by group_by_expression]
        [order by column];

### 2.使用举例

    select deptno, avg(sal) from emp group by deptno;
    select  deptno, job, count(*),avg(sal) from emp group by deptno, job；


### 3.注意事项
- 出现在SELECT列表中的字段，如果不是包含在多行函数中，那么该字段必须同时在GROUP BY子句中出现

        错误：select ename,job,sum(sal) from emp group by job;
- 包含在GROUP BY子句中的字段则不必须出现在SELECT列表中。         

- 如果没有GROUP BY子句，SELECT列表中不允许出现字段（单行函数）与多行函数混用的情况

        •select empno, sal from emp; //合法
        •select avg(sal) from emp; //合法
        •select empno, avg(sal) from emp; //非法
- 不允许在WHERE 子句中使用多行函数

        select deptno, avg(sal) from emp
        where avg(sal) > 2000;   //执行where时尚未执行groupby 及其他
        group by deptno;

### 4.having过滤

> 对分组查询的结果进行过滤，要使用having从句

> having从句过滤分组后的结果，它只能出现在group by从句之后，而where从句要出现在group by从句之前

> where过滤行，having过滤分组

> having支持所有where操作符

#### 语法格式

    select column, group_function(column)
    from table
    [where condition]
    [group by  group_by_expression]
    [having group_condition]
    [order by column];
**执行过程**
###### from--where -- group  by– having– select-- order  by

#### 用法举例

- 在emp表中，列出工资最小值小于2000的职位

        思考：select job,min(sal) from emp where min(sal)<=2000
            Select job,min(sal) from emp group by job having min(sal)<2000

- 列出平均工资大于1200元的部门和工作搭配组合

        select deptno, job, avg(sal)  
        from emp
        group by deptno,job  having avg(sal) > 1200  order by deptno,job;

#### 思考作业
- 统计每个部门的人数，最高工资，最低工资，平均工资
- 统计每个部门的人数，最高工资，最低工资，平均工资，但是排除10部门
- 在emp表中，列出工资最小值小于2000的职位
- 统计人数小于4的部门的平均工资

- 统计各部门的最高工资，排除最高工资小于3000的部门