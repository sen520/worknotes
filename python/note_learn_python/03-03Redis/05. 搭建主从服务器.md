#### Redis 搭建主从复用-读写分离

Redis 支持主从复用。数据可以从主服务器向任意数量的 从服务器上同步，同步使用的是发布/订阅机制。Mater Slave 的模式，从 Slave 向 Master 发起 SYNC 命令。 可以是 1 Master 多 Slave，可以分层，Slave 下可以再接 Slave，可扩展成树状结构.

###### 修改主服务器的配置

```
# 设置从服务器只读模式
slave-read-only yes

# 设置密码  也可以不设置
requirepass 123456
```

###### 修改从服务器的配置

```
# 修改监听的端口，防止冲突
port 6381 

# 指定主服务器的密码
masterauth 123456

# 设置同步的主服务器地址
slaveof 127.0.0.1 6379

```

先启动主服务器，再启动从服务器

使用 `info replication` 命令查询信息

###### 主从复用额流程

1. 当一个从数据库启动时，会向主数据库发送 sync 命令
2. 主数据库接收到 sync 命令后会开始在后台保存快照（执 行 rdb 操作），并将保存期间接收到的命令缓存起来 
3. 当快照完成后，redis 会将快照文件和所有缓存的命令发 送给从数据库
4. 从数据库收到后，会载入快照文件并执行收到的缓存的 命令。 
5. 