### 创建配置html文件

templates下创建login.html

```
{% extends 'index.html' %}
{% load staticfiles %}
{% block body %}
    <div class="container">

        <form class="form-signin" method="post">
            {% csrf_token %}
            <h2 class="form-signin-heading">CRM</h2>
            <label for="inputEmail" class="sr-only">Email address</label>
            <input type="text" id="" name="username" class="form-control" placeholder="Username" required autofocus>
            <label for="inputPassword" class="sr-only">Password</label>
            <input type="password" name="password" id="inputPassword" class="form-control" placeholder="Password" required>
            <div class="checkbox">
                <label>
                    <input type="checkbox" value="remember-me"> Remember me
                </label>
            </div>
            <button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button>
        </form>


    </div> <!-- /container -->


{% endblock body %}
```

css文件夹中新建signin.css文件

```css
body {
  padding-top: 40px;
  padding-bottom: 40px;
  background-color: #eee;
}

.form-signin {
  max-width: 330px;
  padding: 15px;
  margin: 0 auto;
}
.form-signin .form-signin-heading,
.form-signin .checkbox {
  margin-bottom: 10px;
}
.form-signin .checkbox {
  font-weight: normal;
}
.form-signin .form-control {
  position: relative;
  height: auto;
  -webkit-box-sizing: border-box;
     -moz-box-sizing: border-box;
          box-sizing: border-box;
  padding: 10px;
  font-size: 16px;
}
.form-signin .form-control:focus {
  z-index: 2;
}
.form-signin input[type="email"] {
  margin-bottom: -1px;
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}
.form-signin input[type="password"] {
  margin-bottom: 10px;
  border-top-left-radius: 0;
  border-top-right-radius: 0;
}
```

在base.html  header中添加block

```html
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>CRM_SYS</title>

    <!-- Bootstrap core CSS -->
    <link href="{% static 'css/bootstrap_3.3.7_css_bootstrap.min.css' %}" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="{% static 'css/ie10-viewport-bug-workaround.css' %}" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="{% static 'css/dashboard.css' %}" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <script src="{% static 'js/ie-emulation-modes-warning.js' %}"></script>
    
    {% block extra-css %}
    
    {% endblock extra-css %}
</head>
```

在login.html 中{% block body %}上方继承 extra-css

```
{% block extra-css %}
    <link href="{% static 'css/signin.css' %}" rel="stylesheet">
{% endblock extra-css %}
```

### 配置后台文件

#### 1、登录

###### 显示登录界面

配置url

crm_sys/urls.py

```
from django.contrib import admin
from django.urls import path,include
from . import views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('crm/',include('crm.urls')),
    path('login/',views.acc_login),
]
```

在crm_sys下新建views.py文件

```python
from django.shortcuts import render
# Create your views here.
def acc_login(request):
    return render(request,'login.html')
```

这样登录界面就可以了

###### 获取前台传过来的数据

crm_sys/views.py

```python
def acc_login(request):
    if request.method == 'POST':
        username = request.POST.get('username')
        password = request.POST.get('password')
        print(username,password)
    return render(request, 'login.html')
```

运行之后就可以看到你输入的信息

###### 验证数据并跳转

crm_sys/views.py

```python
from django.shortcuts import render
from django.contrib.auth import authenticate

# Create your views here.


def acc_login(request):
    if request.method == 'POST':
        username = request.POST.get('username')
        password = request.POST.get('password')

        user = authenticate(username=username,password=password)
        # 如果验证成功，返回的是用户对象
        # 不成功返回None

        if user:
            # print('验证成功',user)
            login(request,user) # 生成session，真正的登录
            return redirect('/crm/')
        # print(username,password)
    return render(request, 'login.html')
```

###### 设置登录之后右上角显示用户名

templates/index.html

把help改为{{ request.user }}

###### 登录时，用户名密码错误

login.html

```html
...
<div class="checkbox">
	<span style="color: red">{{ error_message }}</span>
    <label>
        <input type="checkbox" value="remember-me"> Remember me
    </label>
</div>
....
```

crm_sys/views.py

```python
def acc_login(request):
    error_message = ''
    if request.method == 'POST':
        username = request.POST.get('username')
        password = request.POST.get('password')

        user = authenticate(username=username, password=password)
        # 如果验证成功，返回的是用户对象
        # 不成功返回None

        if user:
            login(request, user)  # 生成session,真正的登录
            return redirect('/crm/')
        else:
            error_message = 'username or password is error'
    return render(request, 'login.html',{'error_message':error_message})
```



###### 没有登录不能到达crm页面

crm/views.py

```python
from django.shortcuts import render
from django.contrib.auth.decorators import login_required


# Create your views here.
@login_required
def dashboard(request):

    return render(request, 'crm/dashboard.html')
```

crm_sys/settings.py

```python
...
LOGIN_URL = '/login/'
```

crm_sys/views.py

```python
...
if user:
	login(request, user)  # 生成session,真正的登录
	# print(request.GET.get('next'))
	return redirect(request.GET.get('next','/crm/'))
else:
	error_message = 'username or password is error'
...
```



#### 2、退出

###### 页面

在用户名处以下拉框的形式

修改index.html

```html
{% extends 'base.html' %}
{% block body %}
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                        aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://v3.bootcss.com/examples/dashboard/#">{% block pro_name %}Project
                    name{% endblock pro_name %}</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                           aria-expanded="true">{{ request.user }}<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">个人信息</a></li>
                            <li><a href="{% url 'logout' %}">logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 col-md-2 sidebar">
                <ul class="nav nav-sidebar">
                    <li class="active"><a href="https://v3.bootcss.com/examples/dashboard/#">Overview <span
                            class="sr-only">(current)</span></a>
                    </li>
                    <li><a href="https://v3.bootcss.com/examples/dashboard/#">Reports</a></li>
                    <li><a href="https://v3.bootcss.com/examples/dashboard/#">Analytics</a></li>
                    <li><a href="https://v3.bootcss.com/examples/dashboard/#">Export</a></li>
                </ul>
            </div>
            <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
                <h2 class="page-header">Dashboard</h2>
            </div>
        </div>
    </div>
{% endblock body %}
```

###### 后台

crm_sys/urls.py添加

```python
urlpatterns = [
    path('admin/', admin.site.urls),
    path('crm/',include('crm.urls')),
    path('login/',views.acc_login),
    path('logout/',views.acc_logout,name='logout'),
]
```

crm_sys/views.py

```python
from django.contrib.auth import authenticate, login,logout
...
...
...


def acc_logout(request):
    logout(request)
    return redirect('/login/')
```



